<div class="admin-container">
  <div class="header">
    <h1>Gestion des Produits</h1>
    <button class="btn-nouveau" (click)="nouveauProduit()" *ngIf="!modeCreation && !modeEdition">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"/>
        <line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      Nouveau Produit
    </button>
  </div>

  <!-- Formulaire de création/édition -->
  <div class="formulaire-card" *ngIf="modeCreation || modeEdition">
    <h2>{{ modeCreation ? 'Créer un produit' : 'Modifier le produit' }}</h2>

    <form class="formulaire">
      <div class="form-row">
        <div class="form-group">
          <label>Code *</label>
          <input type="text" [(ngModel)]="produitEnCours.code" name="code" required>
        </div>

        <div class="form-group">
          <label>Nom *</label>
          <input type="text" [(ngModel)]="produitEnCours.nom" name="nom" required>
        </div>
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea [(ngModel)]="produitEnCours.description" name="description" rows="3"></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Catégorie *</label>
          <select [(ngModel)]="produitEnCours.categorie" name="categorie" required>
            <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Prix (€) *</label>
          <input type="number" [(ngModel)]="produitEnCours.prix" name="prix" step="0.01" required>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Quantité *</label>
          <input type="number" [(ngModel)]="produitEnCours.quantite" name="quantite" required>
        </div>

        <div class="form-group">
          <label>Statut Inventaire *</label>
          <select [(ngModel)]="produitEnCours.statutInventaire" name="statutInventaire" required>
            <option *ngFor="let statut of statutsInventaire" [value]="statut">{{ statut }}</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Notation (0-5)</label>
          <input type="number" [(ngModel)]="produitEnCours.notation" name="notation" min="0" max="5" step="0.1">
        </div>

        <div class="form-group">
          <label>URL Image</label>
          <input type="text" [(ngModel)]="produitEnCours.image" name="image">
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-annuler" (click)="annuler()">Annuler</button>
        <button type="button" class="btn-sauvegarder" (click)="sauvegarder()">
          {{ modeCreation ? 'Créer' : 'Mettre à jour' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Liste des produits -->
  <div class="table-container" *ngIf="!modeCreation && !modeEdition">
    <table class="produits-table">
      <thead>
      <tr>
        <th>Image</th>
        <th>Code</th>
        <th>Nom</th>
        <th>Catégorie</th>
        <th>Prix</th>
        <th>Stock</th>
        <th>Statut</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let produit of produits">
        <td>
          <img [src]="produit.image" [alt]="produit.nom" class="product-image">
        </td>
        <td><code>{{ produit.code }}</code></td>
        <td>
          <strong>{{ produit.nom }}</strong>
        </td>
        <td><span class="badge-categorie">{{ produit.categorie }}</span></td>
        <td><strong>{{ produit.prix | number:'1.2-2' }} €</strong></td>
        <td>{{ produit.quantite }}</td>
        <td>
            <span class="badge-statut" [ngClass]="obtenirStatutClasse(produit.statutInventaire)">
              {{ produit.statutInventaire }}
            </span>
        </td>
        <td>
          <div class="actions-buttons">
            <button class="btn-action btn-editer" (click)="editerProduit(produit)" title="Modifier">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </button>
            <button class="btn-action btn-supprimer" (click)="supprimer(produit)" title="Supprimer">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
              </svg>
            </button>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
