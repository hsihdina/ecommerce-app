<div class="shop-container">
  <!-- En-tête -->
  <div class="header">
    <h1>Boutique</h1>
    <a routerLink="/panier" class="badge-panier" *ngIf="nombreArticlesPanier > 0">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="8" cy="21" r="1"/>
        <circle cx="19" cy="21" r="1"/>
        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
      </svg>
      <span class="badge">{{ nombreArticlesPanier }}</span>
    </a>
  </div>

  <!-- Filtres -->
  <div class="filtres-container">
    <div class="filtre-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.3-4.3"/>
      </svg>
      <input
        type="text"
        [(ngModel)]="recherche"
        (keyup.enter)="rechercher()"
        placeholder="Rechercher un produit...">
      <button (click)="rechercher()" class="btn-icon">Rechercher</button>
    </div>

    <div class="filtre-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
      </svg>
      <select [(ngModel)]="categorieSelectionnee" (change)="filtrerParCategorie()">
        <option value="">Toutes les catégories</option>
        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
      </select>
    </div>

    <div class="resultats-info">
      <span>{{ totalElements }} produits trouvés</span>
    </div>
  </div>

  <!-- Chargement -->
  <div *ngIf="chargement" class="chargement">
    <div class="spinner"></div>
    <p>Chargement des produits...</p>
  </div>

  <!-- Tableau des produits -->
  <div *ngIf="!chargement" class="table-container">
    <table class="produits-table">
      <thead>
      <tr>
        <th>Image</th>
        <th>Produit</th>
        <th>Code</th>
        <th>Catégorie</th>
        <th>Prix</th>
        <th>Stock</th>
        <th>Statut</th>
        <th>Notation</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let produit of produits">
        <td>
          <img [src]="produit.image" [alt]="produit.nom" class="product-image">
        </td>
        <td>
          <div class="product-info">
            <strong>{{ produit.nom }}</strong>
            <span class="description">{{ produit.description | slice:0:50 }}...</span>
          </div>
        </td>
        <td><code>{{ produit.code }}</code></td>
        <td><span class="badge-categorie">{{ produit.categorie }}</span></td>
        <td style="font-size:14px">
          <strong>{{ produit.prix | currency:'EUR':'symbol':'1.2-2' }}</strong>
        </td>
        <td>{{ produit.quantite }}</td>
        <td>
            <span class="badge-statut" [ngClass]="obtenirStatutClasse(produit.statutInventaire)">
              {{ obtenirStatutTexte(produit.statutInventaire) }}
            </span>
        </td>
        <td>
          <div class="notation">
              <span *ngFor="let etoile of obtenirEtoiles(produit.notation)" class="etoile">
                {{ etoile }}
              </span>
            <span class="note-valeur">({{ produit.notation }})</span>
          </div>
        </td>
        <td>
          <button
            class="btn-ajouter"
            [disabled]="produit.statutInventaire === 'OUTOFSTOCK'"
            (click)="ajouterAuPanier(produit)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="8" cy="21" r="1"/>
              <circle cx="19" cy="21" r="1"/>
              <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
            </svg>
            Ajouter
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div *ngIf="!chargement && totalPages > 1" class="pagination">
    <button
      [disabled]="pageActuelle === 0"
      (click)="changerPage(pageActuelle - 1)"
      class="btn-page">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="15 18 9 12 15 6"/>
      </svg>
      Précédent
    </button>

    <span class="info-page">Page {{ pageActuelle + 1 }} sur {{ totalPages }}</span>

    <button
      [disabled]="pageActuelle >= totalPages - 1"
      (click)="changerPage(pageActuelle + 1)"
      class="btn-page">
      Suivant
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="9 18 15 12 9 6"/>
      </svg>
    </button>
  </div>
</div>
